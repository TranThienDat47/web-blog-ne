{"ast":null,"code":"import _toConsumableArray from\"D:/blog-dat/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"D:/blog-dat/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/blog-dat/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/blog-dat/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useCallback}from'react';import io from'socket.io-client';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CommentList(_ref){var comments=_ref.comments;return/*#__PURE__*/_jsx(\"ul\",{children:comments.map(function(comment){return/*#__PURE__*/_jsx(\"li\",{children:comment.text},comment.id);})});}var CommentForm=/*#__PURE__*/React.memo(function(_ref2){var onSubmit=_ref2.onSubmit;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var handleSubmit=useCallback(function(e){e.preventDefault();onSubmit(text);setText('');},[text,onSubmit]);return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:text,onChange:function onChange(e){return setText(e.target.value);}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Submit\"})]});});function App(){var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),comments=_useState4[0],setComments=_useState4[1];var socket=io('http://localhost:3001');useEffect(function(){var fetchComments=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,newComments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.post('http://localhost:5000/api/comment/get',{_id:'644ffcfbdc6b6409b35dc7c6'});case 3:response=_context.sent;newComments=response.data.comments.map(function(element){return{id:element._id,text:element.content};});setComments(newComments);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 11:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));return function fetchComments(){return _ref3.apply(this,arguments);};}();fetchComments();},[]);useEffect(function(){socket.on('comment',function(comment){setComments(function(comments){return[].concat(_toConsumableArray(comments),[comment]);});});return function(){socket.disconnect();};},[]);var handleCommentSubmit=useCallback(function(text){var comment={id:String(Date.now()),text:text};socket.emit('comment',comment);axios.post('http://localhost:5000/api/comment/create',{parent_id:\"644ffcfbdc6b6409b35dc7c6\",custommer_id:\"63dbe51c7a055d409149d808\",content:text||\" \"}).then(function(response){}).catch(function(error){});},[socket]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Realtime Comments\"}),/*#__PURE__*/_jsx(CommentList,{comments:comments}),/*#__PURE__*/_jsx(CommentForm,{onSubmit:handleCommentSubmit})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useCallback","io","axios","CommentList","comments","map","comment","text","id","CommentForm","memo","onSubmit","setText","handleSubmit","e","preventDefault","target","value","App","setComments","socket","fetchComments","post","_id","response","newComments","data","element","content","console","error","on","disconnect","handleCommentSubmit","String","Date","now","emit","parent_id","custommer_id","then","catch"],"sources":["D:/blog-dat/client/src/App.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport io from 'socket.io-client';\nimport axios from 'axios';\n\ninterface Comment {\n  id: string;\n  text: string;\n}\n\nfunction CommentList({ comments }: { comments: Comment[] }) {\n  return (\n    <ul>\n      {comments.map((comment) => (\n        <li key={comment.id}>{comment.text}</li>\n      ))}\n    </ul>\n  );\n}\n\nconst CommentForm = React.memo(({ onSubmit }: { onSubmit: (text: string) => void }) => {\n  const [text, setText] = useState('');\n\n  const handleSubmit = useCallback(\n    (e: React.FormEvent<HTMLFormElement>) => {\n      e.preventDefault();\n      onSubmit(text);\n      setText('');\n    },\n    [text, onSubmit],\n  );\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input type=\"text\" value={text} onChange={(e) => setText(e.target.value)} />\n      <button type=\"submit\">Submit</button>\n    </form>\n  );\n});\n\nfunction App() {\n\n  const [comments, setComments] = useState<Comment[]>([]);\n  const socket = io('http://localhost:3001');\n\n\n  useEffect(() => {\n    const fetchComments = async () => {\n      try {\n        const response = await axios.post('http://localhost:5000/api/comment/get', {\n          _id: '644ffcfbdc6b6409b35dc7c6',\n        });\n        const newComments = response.data.comments.map((element: any) => {\n          return { id: element._id, text: element.content };\n        });\n        setComments(newComments);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n    fetchComments();\n  }, []);\n\n  useEffect(() => {\n    socket.on('comment', (comment: Comment) => {\n      setComments((comments) => [...comments, comment]);\n    });\n\n    return () => {\n      socket.disconnect();\n    };\n  }, []);\n\n  const handleCommentSubmit = useCallback(\n    (text: string) => {\n      const comment: Comment = { id: String(Date.now()), text };\n      socket.emit('comment', comment);\n      axios.post('http://localhost:5000/api/comment/create', {\n        parent_id: \"644ffcfbdc6b6409b35dc7c6\",\n        custommer_id: \"63dbe51c7a055d409149d808\",\n        content: text || \" \"\n      })\n        .then((response) => {\n        })\n        .catch((error) => {\n        });\n    },\n    [socket],\n  );\n\n  return (\n    <div>\n      <h1>Realtime Comments</h1>\n      <CommentList comments={comments} />\n      <CommentForm onSubmit={handleCommentSubmit} />\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}